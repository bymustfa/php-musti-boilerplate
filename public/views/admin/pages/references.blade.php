@extends('admin.components.layouts.layout')@push('css')    <link rel="stylesheet" href="{{assetAdmin('plugins/summernote/summernote-bs4.css')}}">    <link rel="stylesheet" href="{{assetAdmin('/plugins/morris/morris.css')}}">    <link rel="stylesheet" href="{{assetAdmin('/plugins/sweet-alert2/sweetalert2.css')}}">    <style>        #changeImage {            cursor: pointer;            position: relative;        }        #changeImage:hover:after {            content: 'Resmi Değiştir';            position: absolute;            right: 0;            top: 0;            width: 100%;            background: #000;            padding: 4px;            color: white;        }    </style>@endpush<?php $languages = \App\Models\Languages::all(); ?>@section('main-content')    <div class="content-page">        <div class="content">            <div class="container-fluid">                <div class="page-title-box">                    <div class="row align-items-center">                        <div class="col-sm-12 d-flex align-items-center justify-content-between">                            <h4 class="page-title">Referanslar</h4>                            <button class="btn waves-effect btn-success " id="add_new">                                <i class="fas fa-plus mr-2"></i> Yeni Ekle                            </button>                        </div>                    </div>                </div>                <div class="row">                    <div class="col-md-12 bg-white p-3 border rounded">                        <div class="table-responsive">                            <table class="table table-striped table-bordered table-sm table-hover">                                <thead>                                <tr>                                    <th scope="col">Görsel</th>                                    <th scope="col" width="205px">İşlem</th>                                </tr>                                </thead>                                <tbody>                                @foreach(\App\Models\OurReferences::where(['reference_status' => 1])->get() as $references)                                    <?php $ref = \App\Models\ReferenceContents::where(['reference_id' => $references->id, 'lang_id' => 1])->get()->first() ?>                                    <tr>                                        <td> {!! $references->reference_img? "<img width='55px' src='".base_url(json_decode($references->reference_img, true)['small'])."' />" : "-" !!} </td>                                        <td>                                            <button class="btn waves-effect btn-success btnEdit"                                                    data-id="{{$references->id}}">                                                <i class="fas fa-edit mr-2"></i>                                                Düzenle                                            </button>                                            <button class="btn waves-effect btn-danger btnDelete"                                                    data-id="{{$references->id}}">                                                <i class="fas fa-trash-alt mr-2"></i>                                                Sil                                            </button>                                        </td>                                    </tr>                                @endforeach                                </tbody>                            </table>                        </div>                    </div>                </div>            </div>        </div>        @include('admin.components.Blades.bottom-text')    </div>    <div class="modal fade ReferenceModal" tabindex="-1" role="dialog" aria-labelledby="ReferenceModal"         aria-hidden="true">        <div class="modal-dialog modal-lg" role="document">            <form id="ReferanceForm" enctype="multipart/form-data" class="modal-content ">                <div class="modal-header">                    <h5 class="modal-title" id="ReferenceModal">Referans</h5>                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">                        <span aria-hidden="true">&times;</span>                    </button>                </div>                <div class="modal-body" id="reference_modal_body"></div>                <div class="modal-footer">                    <button type="submit" class="btn btn-primary">Kaydet</button>                </div>            </form>        </div>    </div>@endsection@push('js')    <script src="{{assetAdmin('/plugins/sweet-alert2/sweetalert2.min.js')}}"></script>    <script>        const langs = [];        <?php  foreach ( $languages as $item) { ?>        langs.push({            code: '<?=$item->short_code?>',            id: '<?=$item->id?>',            flag: '<?=$item->language_flag?>',            name: '<?=$item->language_name?>'        })            <?php } ?>        let formType = "new"        $('#add_new').click(function () {            formType = "new"            let content = "";            let langList = ""            langs.map(lang => {                langList += `                <li class="nav-item waves-effect waves-light">                     <a class="nav-link border ${lang.id == "1" ? 'active' : ""}" data-toggle="tab" href="#lang_tab_${lang.id}" role="tab" aria-selected="true">                        <span class="d-none d-md-block">                           <img src="${lang.flag}" width="25px" class="mr-1">                            ${lang.name}                        </span>                    </a>                </li> `;                content += `                    <div class="tab-pane p-3 border ${lang.id === "1" ? 'active' : ""}" id="lang_tab_${lang.id}" role="tabpanel">                        <p class="mb-0">                                 <div class="col-md-12 form-group">                                    <label>Referans Açıklaması:</label>                                   <textarea name="${lang.code}_${lang.id}[content]"  rows="4" placeholder="Referans Açıklaması" class="form-control"></textarea>                               </div>                        </p>                    </div> `;            });            let html = `                <div class="row">                    <div class="col-md-12 form-group">                        <label>Resim:</label>                        <input type="file" class="form-control" name="image" accept="image/*">                    </div>                    <div class="col-md-12">                         <ul class="nav nav-pills nav-justified" role="tablist">${langList}</ul>                         <div class="tab-content">${content}</div>                    </div>                </div> `;            $('#reference_modal_body').html(html)            $('.ReferenceModal').modal('show')        })        $('.ReferenceModal').on('hidden.bs.modal', function (e) {            $('#reference_modal_body').html("")        })        $('.btnDelete').click(function () {            const id = $(this).data('id');            swal({                title: 'Bu Öğreyi Silmek Üzeresiniz',                text: "Silmek İstediğinize Emin misiniz?",                type: 'warning',                showCancelButton: true,                confirmButtonText: 'Evet, Sil!',                cancelButtonText: 'Hayır, İptal!',                confirmButtonClass: 'btn btn-success',                cancelButtonClass: 'btn btn-danger ml-2',                buttonsStyling: false            }).then(function (answer) {                if (answer?.value) {                    $.get(BASE_URL + 'api/reference/delete/' + id, function (response) {                        console.log(response);                        if (response.status) {                            swal('Silme Başarılı', 'Öğe Silindi', 'success');                            setTimeout(() => {                                window.location.reload()                            }, 2000);                        } else {                            swal('Silme Başarısız', response.message, 'error');                        }                    });                }            });        });        $('.btnEdit').click(function () {            formType = "edit";            const id = $(this).data('id');            $.get(BASE_URL + 'api/reference/get/' + id, function (response) {                const {contents, reference} = response                console.log(response)                let content = "";                let langList = ""                langs.map(lang => {                    langList += `                    <li class="nav-item waves-effect waves-light">                         <a class="nav-link border ${lang.id == "1" ? 'active' : ""}" data-toggle="tab"                            href="#lang_tab_${lang.id}" role="tab" aria-selected="true">                            <span class="d-none d-md-block">                               <img src="${lang.flag}" width="25px" class="mr-1">                                ${lang.name}                            </span>                        </a>                    </li> `;                    let contentValues = contents.find(x => x.lang_id == lang.id)                    content += `                    <div class="tab-pane p-3 border ${lang.id === "1" ? 'active' : ""}" id="lang_tab_${lang.id}" role="tabpanel">                        <p class="mb-0">                        <input type="hidden" name="${lang.code}_${lang.id}[id]" value="${contentValues.id}">                                 <div class="col-md-12 form-group">                                    <label>Referans Açıklaması:</label>                                   <textarea name="${lang.code}_${lang.id}[content]"  rows="4" placeholder="Referans Açıklaması" class="form-control" >${contentValues.content}</textarea>                               </div>                        </p>                    </div> `;                });                let img = reference.reference_img ? JSON.parse(reference.reference_img) : {original: "", small: ""}                console.log(img)                let html = `                <div class="row">                <input type="hidden" name="ref_id" value="${id}">                    <div class="col-md-12 form-group text-center">                        <label>Resim:</label><br>                       <label id="changeImage" class="border rounded p-2">                            <input type="file" style="display: none" class="form-control" id="tmpImg" name="image" accept="image/*">                            <img id="refImg" height="100px" src="${BASE_URL + img.original}" >                        </label>                    </div>                    <div class="col-md-12 ">                         <ul class="nav nav-pills nav-justified" role="tablist">${langList}</ul>                         <div class="tab-content">${content}</div>                    </div>                </div> `;                $('#reference_modal_body').html(html)                $('.ReferenceModal').modal('show')                $('#tmpImg').change(function () {                    const file = $(this).prop('files')                    let reader = new FileReader();                    reader.onloadend = function () {                        $("#refImg").attr("src", reader.result)                        // $("textarea").summernote("insertNode", image[0]);                    };                    reader.readAsDataURL(file[0]);                })            });        })        $('#ReferanceForm').submit(function (e) {            e.preventDefault();            const formElement = $(this)            const formData = new FormData(this)            const url = BASE_URL + (formType === 'new' ? 'api/reference/add' : 'api/reference/update')            console.log(url)            $.ajax({                url: url,                type: "POST",                data: formData,                success: function (response) {                    console.log(response);                    if (response.status) {                        alertify.success(response.message);                        setTimeout(() => {                            window.location.reload();                        }, 2000);                    } else {                        alertify.error(response.message);                        formElement                            .find('button[type="submit"]')                            .prop("disabled", false)                            .text("Kaydet");                    }                },                cache: false,                contentType: false,                processData: false,            });        })    </script>@endpush